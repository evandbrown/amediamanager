<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>aMediaManager Home</title>

<link th:href="@{/static/css/a_media_manager.css}" rel="stylesheet"
	type="text/css" />
<link type="text/css"
	th:href="@{/static/css/ui-darkness/jquery-ui-1.8.7.custom.css}"
	rel="stylesheet" />
<script type="text/javascript"
	th:src="@{/static/js/jquery-1.4.4.min.js}"></script>
<script type="text/javascript"
	th:src="@{/static/js/jquery-ui-1.8.7.custom.min.js}"></script>
<script type="text/javascript" th:src="@{/static/js/get-params.js}"></script>

<script type="text/javascript">
//<![CDATA[

function refreshRecentVideos() {
	$.ajax({
				type : "GET",
				url : 'videos',
				success : function(data) {
					results = eval(data);
					count = results.count;
					videos = results.videos;

					$("#Statistics").html('Total Videos: ' + count);
					$('#indexvideoTable tr').not(':first').remove();

					var html = '';
					var i = 0;
				for(i = 0; i < videos.length; i++) {
						$('#indexvideoTable tr:last')
								.after("<tr class='videoLink' name='" + videos[i].key + "'>"
												+ "<td><a href='#'><img src='/"
												+ videos[i].thumbnailKey
												+ "' width='60' height='45' alt='"
												+ videos[i].title
												+ "'/></a></td>"
												+ "<td><a href='#'>"
												+ videos[i].title
												+ "</a> <br /> <strong>Description:</strong>"
												+ videos[i].description
												+ "</td>" + "</tr>");
					}
				},
				complete : function() { // refresh every second
					//setTimeout(refreshRecentVideos, 1000);
				}
			});
}

$(document).ready(function() {

	// Make all video links from the index_video_table.jsp
	// reload the content div with that video
	$('.videoLink').live("click", function(event) {
		var id = $(event.target).closest('tr').attr('name');
		$('#video_player').load("latest_upload.jsp?videoId=" + id);
	});

	$("#indexvideoTable tr").live({
		mouseenter : function() {
			$(this).css("background-color", "#eee");
		},
		mouseleave : function() {
			$(this).css("background-color", "");
		}
	});

	// Log In form dialog			
	$('#dialog').dialog({
		autoOpen : false,
		width : 600,
		buttons : {
			"Ok" : function() {
				$(this).dialog("close");
				// Submit the login form
				$('#loginform').submit();
			},
			"Cancel" : function() {
				$(this).dialog("close");
			}
		}
	});

	// Dialog Link to open the login form
	$('#login_link').click(function() {
		$('#dialog').dialog('open');
		return false;
	});

	// Make enter submit the login dialog as well
	$('#dialog').keyup(function(e) {
		if (e.keyCode == 13) {
			$('#dialog').dialog("close");
			$('#loginform').submit();
		}
	});

	// Registration form dialog			
	$('#registration').dialog({
		autoOpen : false,
		width : 600,
		buttons : {
			"Register" : function() {
				$(this).dialog("close");
				// Submit the registration form
				$('#registerform').submit();
			},
			"Cancel" : function() {
				$(this).dialog("close");
			}
		}
	});

	// Registration Link to open Registration dialog
	$('#registration_link').click(function() {
		$('#registration').dialog('open');
		return false;
	});

	// Error dialog			
	$('#errorDialog').dialog({
		autoOpen : false,
		width : 400,
		buttons : {
			"Close" : function() {
				$(this).dialog("close");
			}
		}
	});

	// Change CSS for icons in hover state
	$('#dialog_link, ul#icons li').hover(function() {
		$(this).addClass('ui-state-hover');
	}, function() {
		$(this).removeClass('ui-state-hover');
	});
	
	// Display error if it exists
	if($('#errorDialog').length != 0) {
		$('#errorDialog').dialog('open');
	}

	//setTimeout(refreshRecentVideos(), 1000);
});
//]]>
</script>
<style type="text/css">
ul#icons {
	margin: 0;
	padding: 0;
}

ul#icons li {
	margin: 2px;
	position: relative;
	padding: 4px 0;
	cursor: pointer;
	float: left;
	list-style: none;
}

ul#icons span.ui-icon {
	float: left;
	margin: 0 4px;
}

#indexvideoTable th {
	font-size: 12px;
	background: #fbb117;
	color: #7b3f00
}

#indexvideoTable td {
	text-align: left;
	padding-bottom: 2px;
	padding-top: 2px;
	padding-right: 4px;
}

#indexvideoTable {
	font-size: 9px;
	background: #fafafa;
	width: 300px;
	margin-left: 10px;
}
}
</style>
</head>
<body>
	<div class="container">
		<div th:include="header"></div>
		<div class="indsidebar1"></div>
		<div id="video_player" class="content">
			<!-- <jsp:include page="latest_upload.jsp" /> -->
		</div>
		<div class="indexsidebar2">
			<table id="indexvideoTable" border="0" cellspacing="0"
				cellpadding="0" width="200">
				<tr>
					<th colspan="2">Latest Videos</th>
				</tr>
			</table>
		</div>
		<div th:include="footer"></div>
	</div>

	<!--  Hidden login  -->
	<div id="dialog" title="Sign In">
		<form id="loginform" method="post"
			th:action="@{/j_spring_security_check}">
			<table>
				<tr>
					<td align="right">E-mail:</td>
					<td><input name="j_username" type="text" value="" size="40"
						maxlength="40" /></td>
				</tr>
				<tr>
					<td align="right">Password:</td>
					<td><input name="j_password" type="password" value=""
						size="40" maxlength="40" /></td>
				</tr>
			</table>
		</form>
		<br />

	</div>

	<!--  Registration  -->
	<div id="registration" title="Register">
		<form id="registerform" method="post" th:action="@{/register}">
			<table>
				<tr>
					<td align="right">Email Address:</td>
					<td><input name="email" type="text" value="" size="40"
						maxlength="40" /></td>
				</tr>
				<tr>
					<td align="right">Nickname:</td>
					<td><input name="nickname" type="text" value="" size="40"
						maxlength="40" /></td>
				</tr>
				<tr>
					<td align="right">Motto:</td>
					<td><input name="tagline" type="text" value="" size="40"
						maxlength="40" /></td>
				</tr>
				<tr>
					<td align="right">Password:</td>
					<td><input name="password" type="password" value="" size="40"
						maxlength="40" /></td>
				</tr>
			</table>
		</form>
	</div>

	<!-- Error message dialog -->
	<div id="errorDialog" title="An Error Has Occurred!" th:if="${not #strings.isEmpty(error)}" th:text="${error}"></div>

</body>
</html>